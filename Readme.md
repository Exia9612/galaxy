# Galaxy

Galaxy æ˜¯ä¸€ä¸ªåŸºäº pnpm workspace çš„ monorepo é¡¹ç›®ï¼ŒåŒ…å«å¤šä¸ªåŠŸèƒ½æ¨¡å—å’Œå·¥å…·åŒ…ã€‚

## ğŸ“¦ é¡¹ç›®ç»“æ„

```
galaxy/
â”œâ”€â”€ apps/              # åº”ç”¨ç›®å½•
â”‚   â””â”€â”€ solar/         # Next.js åº”ç”¨ç¤ºä¾‹
â”œâ”€â”€ packages/          # æ ¸å¿ƒåŒ…ç›®å½•
â”‚   â”œâ”€â”€ eventBus/      # äº‹ä»¶æ€»çº¿
â”‚   â”œâ”€â”€ galaxyDI/      # ä¾èµ–æ³¨å…¥å®¹å™¨
â”‚   â”œâ”€â”€ galaxyObserver/# å“åº”å¼ç³»ç»Ÿ
â”‚   â””â”€â”€ sentinel/      # å‰ç«¯ç›‘æ§ SDK
â””â”€â”€ tools/             # å·¥å…·è„šæœ¬
```

## ğŸ¯ æ ¸å¿ƒåŒ…ä»‹ç»

### eventBus

è½»é‡çº§äº‹ä»¶æ€»çº¿ï¼Œæä¾›å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼Œæ”¯æŒäº‹ä»¶ç›‘å¬ã€å–æ¶ˆç›‘å¬å’Œä¸€æ¬¡æ€§ç›‘å¬ã€‚

**åŠŸèƒ½ç‰¹æ€§ï¼š**

- ç±»å‹å®‰å…¨çš„äº‹ä»¶è®¢é˜…/å‘å¸ƒ
- æ”¯æŒä¸€æ¬¡æ€§äº‹ä»¶ç›‘å¬ï¼ˆ`once`ï¼‰
- æ”¯æŒæ‰¹é‡å–æ¶ˆè®¢é˜…

**ä½¿ç”¨ç¤ºä¾‹ï¼š**

```typescript
import { EventBus } from "eventBus";

const bus = new EventBus<string>();
bus.subscribe("event", () => console.log("triggered"));
bus.publish("event");
```

### galaxyDI

ä¾èµ–æ³¨å…¥å®¹å™¨ï¼Œæä¾›ç±»ä¼¼ Angular çš„ä¾èµ–æ³¨å…¥èƒ½åŠ›ï¼Œæ”¯æŒæ„é€ å‡½æ•°æ³¨å…¥å’Œä¾èµ–è§£æã€‚

**åŠŸèƒ½ç‰¹æ€§ï¼š**

- æ”¯æŒ `useClass`ã€`useValue`ã€`useFactory`ã€`useDefinedValue` å¤šç§æä¾›æ–¹å¼
- è‡ªåŠ¨ä¾èµ–è§£æ
- æ”¯æŒæ„é€ å‡½æ•°å‚æ•°æ³¨å…¥

**ä½¿ç”¨ç¤ºä¾‹ï¼š**

```typescript
import { createContainer, resolveContainer } from "galaxyDI";

const container = resolveContainer(
	createContainer([
		{
			name: "service",
			useClass: MyService,
			deps: ["dependency"],
		},
	]),
);

const service = container.get<MyService>("service");
```

### galaxyObserver

å“åº”å¼ç³»ç»Ÿï¼Œæä¾›ç±»ä¼¼ Vue 3 çš„å“åº”å¼èƒ½åŠ›ï¼ŒåŒ…æ‹¬ `reactive`ã€`ref`ã€`computed`ã€`watch` ç­‰ APIã€‚

**åŠŸèƒ½ç‰¹æ€§ï¼š**

- åŸºäº Proxy çš„å“åº”å¼å®ç°
- æ”¯æŒ `reactive`ã€`readonly`ã€`shallowReactive` ç­‰å¤šç§å“åº”å¼ç±»å‹
- æä¾› `ref`ã€`computed`ã€`watch` ç­‰ç»„åˆå¼ API
- å®Œæ•´çš„ä¾èµ–è¿½è¸ªå’Œå‰¯ä½œç”¨ç®¡ç†

**ä½¿ç”¨ç¤ºä¾‹ï¼š**

```typescript
import { reactive, watch } from "galaxyObserver";

const state = reactive({ count: 0 });
watch(
	() => state.count,
	(newVal) => {
		console.log("count changed:", newVal);
	},
);
```

### sentinel

å‰ç«¯ç›‘æ§ SDKï¼Œæä¾›å…¨é¢çš„æ€§èƒ½ç›‘æ§ã€è¡Œä¸ºç›‘æ§å’Œé”™è¯¯ç›‘æ§èƒ½åŠ›ã€‚

#### æ ¸å¿ƒåŠŸèƒ½

**1. æ€§èƒ½ç›‘æ§**

- **FP (First Paint)**: é¦–æ¬¡ç»˜åˆ¶æ—¶é—´
- **FCP (First Contentful Paint)**: é¦–æ¬¡å†…å®¹ç»˜åˆ¶æ—¶é—´
- **LCP (Largest Contentful Paint)**: æœ€å¤§å†…å®¹ç»˜åˆ¶æ—¶é—´
- **FID (First Input Delay)**: é¦–æ¬¡è¾“å…¥å»¶è¿Ÿ
- **é™æ€èµ„æºç›‘æ§**: DNSã€TCPã€SSLã€TTFBã€ä¼ è¾“æ—¶é—´ç­‰

**2. è¡Œä¸ºç›‘æ§**

- **é¡µé¢ä¿¡æ¯**: é¡µé¢ URLã€æ ‡é¢˜ã€æ—¶é—´æˆ³ç­‰
- **è·¯ç”±å˜åŒ–**: SPA è·¯ç”±åˆ‡æ¢è®°å½•
- **PV ç»Ÿè®¡**: é¡µé¢è®¿é—®é‡ç»Ÿè®¡
- **ç”¨æˆ·æ¥æº**: æ¥æºé¡µé¢ã€æ¥æºåŸŸåç­‰
- **ç”¨æˆ·ä»£ç†**: æµè§ˆå™¨ã€è®¾å¤‡ä¿¡æ¯è§£æ
- **HTTP è¯·æ±‚**: Fetch å’Œ XMLHttpRequest æ‹¦æˆª
- **è‡ªå®šä¹‰è¡Œä¸º**: æ”¯æŒç”¨æˆ·è‡ªå®šä¹‰è¡Œä¸ºä¸ŠæŠ¥

**3. é”™è¯¯ç›‘æ§**

- åº”ç”¨é”™è¯¯æ•è·ï¼ˆå¼€å‘ä¸­ï¼‰

**4. æ’ä»¶ç³»ç»Ÿ**

- åŸºäº `tapable` çš„æ’ä»¶æ¶æ„
- æ”¯æŒç”Ÿå‘½å‘¨æœŸé’©å­ï¼ˆ`beforeInit`ã€`afterInit` ç­‰ï¼‰
- å¯æ‰©å±•çš„æ’ä»¶æœºåˆ¶

**5. æ•°æ®ä¸ŠæŠ¥**

- æ”¯æŒå¤šç§ä¸ŠæŠ¥æ–¹å¼ï¼š`navigator.sendBeacon`ã€`XMLHttpRequest`ã€`Image`
- æ”¯æŒç«‹å³ä¸ŠæŠ¥å’Œå»¶è¿Ÿä¸ŠæŠ¥
- æ”¯æŒæ‰¹é‡ä¸ŠæŠ¥å’Œè¯·æ±‚åˆå¹¶

#### æ¶æ„è®¾è®¡

**æ¶æ„æµç¨‹å›¾ï¼š**

```mermaid
graph TB
    subgraph "Sentinel SDK"
        PM[Performance Manager<br/>æ€§èƒ½ç›‘æ§ç®¡ç†å™¨]
        BM[Behavior Manager<br/>è¡Œä¸ºç›‘æ§ç®¡ç†å™¨]
        EM[Error Manager<br/>é”™è¯¯ç›‘æ§ç®¡ç†å™¨]

        PM --> Store[Store<br/>æ•°æ®å­˜å‚¨<br/>Mapç»“æ„]
        BM --> Store
        EM --> Store

        Store --> Plugin[Plugin System<br/>æ’ä»¶ç³»ç»Ÿ<br/>åŸºäºtapable]
        Store --> Report[Report<br/>æ•°æ®ä¸ŠæŠ¥<br/>sendBeacon/XHR/Image]

        DI[DI Container<br/>ä¾èµ–æ³¨å…¥å®¹å™¨<br/>galaxyDI] --> PM
        DI --> BM
        DI --> EM
        DI --> Store
        DI --> Plugin
        DI --> Report

        subgraph "å¤–éƒ¨ä¾èµ–"
            Observer[galaxyObserver<br/>å“åº”å¼ç³»ç»Ÿ]
            DI2[galaxyDI<br/>ä¾èµ–æ³¨å…¥]
            Bus[eventBus<br/>äº‹ä»¶æ€»çº¿]
            Tapable[tapable<br/>æ’ä»¶ç³»ç»Ÿ]
        end

        Observer -.-> Store
        DI2 -.-> DI
        Bus -.-> Report
        Tapable -.-> Plugin
    end

    style PM fill:#e1f5ff
    style BM fill:#e1f5ff
    style EM fill:#e1f5ff
    style Store fill:#fff4e1
    style Plugin fill:#e8f5e9
    style Report fill:#fce4ec
    style DI fill:#f3e5f5
```

**æ¶æ„è¯´æ˜ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Sentinel SDK                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  æ€§èƒ½ç›‘æ§     â”‚  â”‚  è¡Œä¸ºç›‘æ§     â”‚  â”‚  é”™è¯¯ç›‘æ§     â”‚      â”‚
â”‚  â”‚ Performance  â”‚  â”‚   Behavior   â”‚  â”‚    Error     â”‚      â”‚
â”‚  â”‚   Manager    â”‚  â”‚   Manager    â”‚  â”‚   Manager    â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚         â”‚                 â”‚                  â”‚               â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                           â”‚                                    â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚                  â”‚   Store (å­˜å‚¨)   â”‚                          â”‚
â”‚                  â”‚   - Map<K, T>   â”‚                          â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                           â”‚                                    â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚         â”‚                 â”‚                 â”‚                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  æ’ä»¶ç³»ç»Ÿ    â”‚  â”‚  æ•°æ®ä¸ŠæŠ¥     â”‚  â”‚  ä¾èµ–æ³¨å…¥     â”‚         â”‚
â”‚  â”‚   Plugin    â”‚  â”‚    Report    â”‚  â”‚     DI      â”‚         â”‚
â”‚  â”‚   System    â”‚  â”‚              â”‚  â”‚  Container  â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              å¤–éƒ¨ä¾èµ–                                  â”‚    â”‚
â”‚  â”‚  - galaxyObserver (å“åº”å¼ç³»ç»Ÿ)                        â”‚    â”‚
â”‚  â”‚  - galaxyDI (ä¾èµ–æ³¨å…¥)                                â”‚    â”‚
â”‚  â”‚  - eventBus (äº‹ä»¶æ€»çº¿)                                â”‚    â”‚
â”‚  â”‚  - tapable (æ’ä»¶ç³»ç»Ÿ)                                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ¶æ„äº®ç‚¹

1. **ä¾èµ–æ³¨å…¥æ¶æ„**
   - ä½¿ç”¨ `galaxyDI` å®ç°æ¾è€¦åˆçš„æ¨¡å—è®¾è®¡
   - æ‰€æœ‰æ ¸å¿ƒæ¨¡å—é€šè¿‡ DI å®¹å™¨ç®¡ç†ï¼Œä¾¿äºæµ‹è¯•å’Œæ‰©å±•
   - æ”¯æŒä¾èµ–è‡ªåŠ¨è§£æå’Œæ³¨å…¥

2. **æ’ä»¶åŒ–è®¾è®¡**
   - åŸºäº `tapable` çš„æ’ä»¶ç³»ç»Ÿï¼Œæä¾›ä¸°å¯Œçš„ç”Ÿå‘½å‘¨æœŸé’©å­
   - æ”¯æŒè‡ªå®šä¹‰æ’ä»¶æ‰©å±•åŠŸèƒ½
   - æ’ä»¶å¯ä»¥åœ¨æ•°æ®æ”¶é›†ã€ä¸ŠæŠ¥ç­‰å„ä¸ªç¯èŠ‚è¿›è¡Œæ‹¦æˆªå’Œå¤„ç†

3. **å“åº”å¼æ•°æ®ç®¡ç†**
   - ä½¿ç”¨ `galaxyObserver` å®ç°å“åº”å¼æ•°æ®å­˜å‚¨
   - é€šè¿‡ `watch` ç›‘å¬æŒ‡æ ‡å˜åŒ–ï¼Œåº”å¯¹æ€§èƒ½æ•°æ®çš„å¼‚æ­¥æ”¶é›†é—®é¢˜
   - æ•°æ®å˜åŒ–è‡ªåŠ¨è§¦å‘ä¸ŠæŠ¥é€»è¾‘

4. **å¤šç»´åº¦ç›‘æ§**
   - æ€§èƒ½ç›‘æ§ï¼šè¦†ç›– Web Vitals æ ¸å¿ƒæŒ‡æ ‡
   - è¡Œä¸ºç›‘æ§ï¼šå®Œæ•´çš„ç”¨æˆ·è¡Œä¸ºè¿½è¸ªé“¾è·¯
   - é”™è¯¯ç›‘æ§ï¼šåº”ç”¨é”™è¯¯æ•è·å’Œåˆ†æ

5. **æ™ºèƒ½ä¸ŠæŠ¥ç­–ç•¥**
   - æ”¯æŒ `sendBeacon` åœ¨é¡µé¢å¸è½½æ—¶å¯é ä¸ŠæŠ¥
   - å»¶è¿Ÿä¸ŠæŠ¥å’Œæ‰¹é‡åˆå¹¶ï¼Œå‡å°‘ç½‘ç»œè¯·æ±‚
   - ä½¿ç”¨ `requestIdleCallback` åœ¨æµè§ˆå™¨ç©ºé—²æ—¶ä¸ŠæŠ¥ï¼Œä¸å½±å“é¡µé¢æ€§èƒ½

6. **ç±»å‹å®‰å…¨**
   - å®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰
   - ç±»å‹å®‰å…¨çš„æŒ‡æ ‡æšä¸¾å’Œå€¼ç±»å‹æ˜ å°„

**ä½¿ç”¨ç¤ºä¾‹ï¼š**

```typescript
import { createDIContainer } from "sentinel";

const container = createDIContainer({
	appId: "your-app-id",
	plugins: [customPlugin],
	report: {
		path: "https://your-report-endpoint.com",
		immediateReport: false,
		lazyReportTimeout: 1000,
	},
	behavior: {
		maxBehaviorStack: 100,
	},
});
```

## ğŸ› ï¸ å¼€å‘å·¥å…·

### ä»£ç è´¨é‡

- **ESLint**: ä»£ç è´¨é‡æ£€æŸ¥
- **Prettier**: ä»£ç æ ¼å¼åŒ–
- **Stylelint**: æ ·å¼ä»£ç æ£€æŸ¥
- **Husky**: Git hooks ç®¡ç†
- **lint-staged**: æš‚å­˜æ–‡ä»¶ lint

### æ„å»ºå·¥å…·

- **Rollup**: åº“åŒ…æ„å»ºï¼ˆeventBusã€galaxyDIã€galaxyObserverï¼‰
- **Webpack**: åº”ç”¨æ„å»ºï¼ˆsentinelï¼‰
- **TypeScript**: ç±»å‹æ£€æŸ¥å’Œç¼–è¯‘

## ğŸ“ å¼€å‘è§„èŒƒ

### Monorepo é…ç½®å¿ƒå¾—

#### package.json

- **engines**: å¯¹äº NPM æ¥è¯´ï¼Œ`engines` åªæ˜¯èµ·è¯´æ˜ä½œç”¨ï¼Œå³ä½¿ç”¨æˆ·å®‰è£…çš„ç‰ˆæœ¬ä¸ç¬¦åˆè¦æ±‚ï¼Œä¹Ÿä¸å½±å“ä¾èµ–åŒ…çš„å®‰è£…ã€‚ä½†ä½¿ç”¨ pnpm å’Œ yarn å®‰è£…ï¼Œå¦‚æœç‰ˆæœ¬ä¸ç¬¦åˆè¦æ±‚ä¼šå¯¼è‡´å®‰è£…å¤±è´¥

#### ESLint VS Prettier

- **Prettier**: è´Ÿè´£ä»£ç æ ¼å¼åŒ–ï¼ˆformattingï¼‰
- **ESLint**: è´Ÿè´£ä»£ç è´¨é‡æ£€æŸ¥ï¼ˆcode-qualityï¼‰
- Prettier å¯¹ä»£ç é”™è¯¯ä¸åšæ£€æŸ¥

**ä¸ºä»€ä¹ˆä¼šæœ‰å†²çªï¼Ÿ**

- Linter é‡Œæœ‰è®¸å¤šä»£ç é£æ ¼è§„åˆ™ä¸ Prettier å†²çª
- å»ºè®®ä½¿ç”¨ `eslint-config-prettier` ç¦ç”¨ ESLint ä¸­ä¸ Prettier å†²çªçš„è§„åˆ™

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¾èµ–

```bash
pnpm install
```

### å¼€å‘

```bash
# å¹¶è¡Œè¿è¡Œæ‰€æœ‰åŒ…çš„ dev è„šæœ¬
pnpm dev

# è¿è¡Œç‰¹å®šåŒ…
pnpm --filter <package-name> dev
```

### æ„å»º

```bash
# æ„å»ºæ‰€æœ‰åŒ…
pnpm build

# æ„å»ºç‰¹å®šåŒ…
pnpm --filter <package-name> build
```

### æµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pnpm test

# è¿è¡Œç‰¹å®šåŒ…çš„æµ‹è¯•
pnpm --filter <package-name> test
```

### ä»£ç æ£€æŸ¥

```bash
# Lint æ£€æŸ¥
pnpm lint

# è‡ªåŠ¨ä¿®å¤
pnpm lint:fix
```

## ğŸ“„ License

ISC
